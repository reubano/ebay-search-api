sudo: false
language: python
matrix:
  include:
  - python: '2.7'
    install:
    - pip install -U pip
    - pip install wheel
    - pip install -r dev-requirements.txt
    - pip install -r py2-requirements.txt
  - python: '3.5'
    install:
    - pip install -U pip
    - pip install wheel
    - pip install -r dev-requirements.txt
    - pip install -r requirements.txt
  - python: '3.6'
    install:
    - pip install -U pip
    - pip install wheel
    - pip install -r dev-requirements.txt
    - pip install -r requirements.txt
    addons:
      apt:
        sources: heroku
        packages: heroku-toolbelt
cache:
  directories:
  - "~/.cache/pip"
notifications:
  email:
    on_success: always
before_script:
- openssl aes-256-cbc -d -k "$secret" -in envs.yml.enc -a -out envs.yml
script:
- manage lint && manage test
after_success:
- if [[ "$TRAVIS_PULL_REQUEST" == "true" ]]; then exit 0; fi
- if [[ "$TRAVIS_BRANCH" != "master" ]]; then exit 0; fi
- if [[ "$TRAVIS_PYTHON_VERSION" != "3.6" ]]; then exit 0; fi
- git remote add heroku git@heroku.com:amzn-search-api.git
- echo "Host heroku.com" >> ~/.ssh/config
- echo "   StrictHostKeyChecking no" >> ~/.ssh/config
- echo "   CheckHostIP no" >> ~/.ssh/config
- echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
- heroku keys:clear
- yes | heroku keys:add
- yes | git push heroku master
env:
  global:
  - secure: Cy2XEgF4c7GQri5EoJCq5KqGI6dQFHYp2L1JsUPTxegdmAMU06aFRRSy+Z5n0SQMB7Kt2jCt4qACioYiSiiICm67tjSKz8qA2eown1J39NCF+6rSMPctupy61T7tvPo5nFfTiPRl9Qs6zKWQsp761XSI1MzXk+Ppbot3vIKmee0=
  - secure: HIQqUxlKJR4fCcJ81goT+0UiRe05IQHQhfX5faO5skQpjmLOFVuIdoQ8EMqTwaN1lSAxb1lBC3+pYOnHFs68rF0yvKdxe5oUs++k/BmxrVa/3t3Y1e4Ui4Zrf6dexiakSti19J/z7ni/F6ic1AaZpUTxmF820Bk26qGpjU+clAE=
  - secure: VhRlg3oe7WrSJU8UUdWflTg2k2EcIyYaUFwkXBEB0qJ7iMZIywqIlcnYXDknvJ/ishWKLLl1Uu1doKo3Jd3U/Qebdj0HUYoxEGdwczzAPJPbNDpaTrWYci5f1cvp8fFysNyFWpTNWOcNPbLt1fQ2MJmXHP6g9AnZzgxJ2tGR5rY=
  - secure: fABUQpDhEtHbbC5x85jqNFxYuEAI5hYkNI6oX7vzZtQy3lsuvdsN/WqS0vAawpBlCluhc4ak4LwwlvTPC1ZBv9ii7SIT8nF5bakY8hIUoJDBSVgTjIutUYch/BX5Yj1LnbAMU8WGFor+gPJxdrgKXkFhwlsUExF84qynAuQFdew=
  - secure: BTVB/JGBOCxqYDWmdoXts0fWc+KDfxIvQJOzMe5LIYvsDwzBv0L7gz+cC7sfKcfu7tpL7n2o4yPzZXd1Ak4GXuOnHlO/Uz4Um0rBAiOPn9Yn6mRzsYEHeAlaprjLJW17vZHC1y1Jag7m2Ip8E5afqcnc81avOjCw0czQOf9PVsQ=
  - secure: ZE2W74onObCUWv3VuVBAPvddciay+l9uuhwCMX5cIqsXdi3EzylMVoNkbx4HB+fjX4enuvu+MVlWo74By221Ctovzcr03DlzUSKvSjaLYtp+O3EOXI/CHXDcKxLEaKhu3FbB6AHUHESwu6tbbiYH76AHI7LQsHuyFLewIK833zE=
